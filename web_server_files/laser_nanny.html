<!DOCTYPE html>
<html lang="en-US">
<body>

<h1>WS88 Exhaust Duct and Laser Cabinent Temperature</H1>

<div id="chart_div"></div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">


// Load google charts
google.charts.load('current', {'packages':['corechart', 'gauge']});
google.charts.setOnLoadCallback(drawChart);


function getFileFromServer(url, doneCallback) {
   var xhr;    xhr = new XMLHttpRequest();
   xhr.onreadystatechange = handleStateChange;
   xhr.open("GET", url, true);
   xhr.send();    
   function handleStateChange() 
   {
       if (xhr.readyState === 4) 
       {
           doneCallback(xhr.status == 200 ? xhr.responseText : null);
       }
   }
}


// Draw the chart and set the chart values
function drawChart() {

  var data = google.visualization.arrayToDataTable([
    ['Label', 'Temperature'],
    ['Duct', 0],
  ]);

  var options = {
    width: 500,
    height: 250,
    redFrom: -20,
    redTo: 0,
    yellowFrom: 0,
    yellowTo: 5,
    greenFrom: 5,
    greenTo: 35,
    yellowFrom: 35,
    yellowTo: 50,
    redFrom: 50,
    redTo: 100,
    minorTicks: 10,
    min: -20,
    max: 100,
    majorTicks: [
      '-20', 
      '-10',
      '0', 
      '10',
      '20', 
      '30',
      '40', 
      '50',
      '60', 
      '70',
      '80', 
      '90',
      '100', 
    ]
  };

  var chart = new google.visualization.Gauge(document.getElementById('chart_div'));

  var allText =[];
  var sourceLines = [];
  var dataLines = [];
  var fields = [];
  var txtFileSync = new XMLHttpRequest();
  txtFileSync.open("GET","laser_nanny_data.txt",false);
  txtFileSync.send();
  allText = txtFileSync.responseText;
  sourceLines = allText.split(/\r\n|\n/);
  fields = sourceLines[sourceLines.length - 2].split(',')

  var temperature_read_duct = parseFloat(fields[0]);
  var temperature_read_laser = parseFloat(fields[1]);
  var time_stamp_from_laser = parseFloat(fields[2]);

  txtFileSync=null;
  allText = null;

  var data = google.visualization.arrayToDataTable([
    ['Label', 'Temperature'],
    ['Duct', temperature_read_duct],
    ['Laser', temperature_read_laser],
  ]);
  chart.draw(data, options);
}

</script>
</body>
</html>
